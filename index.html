<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Line Counter Pro</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        padding: 30px;
        text-align: center;
        color: white;
      }

      .title {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .progress-display {
        background: #f8f9ff;
        padding: 40px;
        text-align: center;
        border-bottom: 1px solid #e0e6ed;
      }

      .progress-ratio {
        font-size: 4em;
        font-weight: 800;
        color: #4facfe;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .progress-label {
        font-size: 1.2em;
        color: #666;
        margin-bottom: 20px;
      }

      .target-message {
        background: linear-gradient(135deg, #56ccf2, #2f80ed);
        color: white;
        padding: 15px 30px;
        border-radius: 50px;
        font-size: 1.3em;
        font-weight: 600;
        margin-top: 20px;
        display: none;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .controls {
        padding: 30px;
        background: #fff;
      }

      .input-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .input-field {
        position: relative;
      }

      .input-field label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
        font-size: 0.95em;
      }

      .input-field input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e6ed;
        border-radius: 12px;
        font-size: 1.1em;
        transition: all 0.3s ease;
        background: #fafbff;
      }

      .input-field input:focus {
        outline: none;
        border-color: #4facfe;
        background: white;
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
      }

      .reset-button {
        background: linear-gradient(135deg, #ff6b6b, #ffa500);
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 50px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
      }

      .reset-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
      }

      .reset-button:active {
        transform: translateY(0);
      }

      .textarea-section {
        padding: 30px;
        background: #f8f9ff;
        border-top: 1px solid #e0e6ed;
      }

      .textarea-label {
        font-size: 1.2em;
        font-weight: 600;
        color: #555;
        margin-bottom: 15px;
        display: block;
      }

      .code-textarea {
        width: 100%;
        min-height: 300px;
        padding: 20px;
        border: 2px solid #e0e6ed;
        border-radius: 12px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.95em;
        line-height: 1.6;
        background: white;
        resize: vertical;
        transition: all 0.3s ease;
      }

      .code-textarea:focus {
        outline: none;
        border-color: #4facfe;
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
      }

      .paste-info {
        margin-top: 15px;
        padding: 15px;
        background: #e8f4ff;
        border-radius: 10px;
        font-size: 0.9em;
        color: #666;
        border-left: 4px solid #4facfe;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid #e0e6ed;
      }

      .stat-number {
        font-size: 2em;
        font-weight: 700;
        color: #4facfe;
      }

      .stat-label {
        font-size: 0.9em;
        color: #666;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 class="title">Line Counter Pro</h1>
        <p class="subtitle">Track your code progress with style</p>
      </div>

      <div class="progress-display">
        <div class="progress-ratio" id="progressRatio">0 / 0</div>
        <div class="progress-label">Target Progress: (L + N) / (N / C)</div>
        <div class="target-message" id="targetMessage">
          🎉 You have reached the target number of lines! 🎉
        </div>
      </div>

      <div class="controls">
        <div class="input-group">
          <div class="input-field">
            <label for="coefficient">Coefficient (C)</label>
            <input
              type="number"
              id="coefficient"
              step="0.1"
              value="0.3"
              min="0"
            />
          </div>
          <div class="input-field">
            <label for="target">Target Lines (L)</label>
            <input
              type="number"
              id="target"
              step="1"
              min="1"
              placeholder="Enter target..."
            />
          </div>
        </div>

        <div style="text-align: center">
          <button class="reset-button" onclick="resetCounter()">
            Reset Line Counter
          </button>
        </div>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalLines">0</div>
            <div class="stat-label">Total Lines (N)</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="adjustedLines">0</div>
            <div class="stat-label">Max</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="pasteCount">0</div>
            <div class="stat-label">Pastes</div>
          </div>
        </div>
      </div>

      <div class="textarea-section">
        <label class="textarea-label" for="codeArea"
          >Accumulated Code/Text</label
        >
        <textarea
          id="codeArea"
          class="code-textarea"
          placeholder="Paste your code here or use Ctrl+V to paste from clipboard..."
        ></textarea>
        <div class="paste-info">
          💡 <strong>Tip:</strong> Press Ctrl+V anywhere on the page to append
          clipboard content (text or files) to the textarea. Supports common
          code file formats: .txt, .js, .ts, .py, .java, .cpp, .css, .html,
          .json, .md, and more!
        </div>
      </div>
    </div>

    <script>
      let totalLines = 0;
      let pasteCount = 0;
      let currentText = '';

      // DOM elements
      const progressRatio = document.getElementById('progressRatio');
      const targetMessage = document.getElementById('targetMessage');
      const coefficientInput = document.getElementById('coefficient');
      const targetInput = document.getElementById('target');
      const codeArea = document.getElementById('codeArea');
      const totalLinesDisplay = document.getElementById('totalLines');
      const adjustedLinesDisplay = document.getElementById('adjustedLines');
      const pasteCountDisplay = document.getElementById('pasteCount');

      function countLines(text) {
        if (!text) return 0;
        return text.split(/\r\n|\r|\n/).length;
      }

      function updateDisplay() {
        const coefficient = parseFloat(coefficientInput.value) || 0.3;
        const target = parseInt(targetInput.value) || 0;
        const adjustedLines = Math.floor(target / coefficient);

        // Update progress ratio
        progressRatio.textContent = `${
          totalLines + target
        } / (${adjustedLines}) `;

        // Update stats
        totalLinesDisplay.textContent = totalLines;
        adjustedLinesDisplay.textContent = Math.round(adjustedLines);
        pasteCountDisplay.textContent = pasteCount;

        // Check target achievement
        if (target > 0 && totalLines + target >= adjustedLines) {
          targetMessage.style.display = 'block';
          progressRatio.style.color = '#56ccf2';
        } else {
          targetMessage.style.display = 'none';
          progressRatio.style.color = '#4facfe';
        }
      }

      function handleTextChange() {
        const newText = codeArea.value;
        if (newText !== currentText) {
          totalLines = countLines(newText);
          currentText = newText;
          updateDisplay();
        }
      }

      function handlePaste(e) {
        pasteCount++;

        // Check if there are files in the paste event
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        let fileProcessed = false;

        console.log(
          'Paste event detected, checking for files...',
          items.length,
          'items'
        );

        for (let i = 0; i < items.length; i++) {
          const item = items[i];
          console.log('Item', i, '- kind:', item.kind, 'type:', item.type);

          // Check if it's a file
          if (item.kind === 'file') {
            const file = item.getAsFile();
            console.log(
              'File detected:',
              file.name,
              'type:',
              file.type,
              'size:',
              file.size
            );

            // Check if it's a text-based file
            if (
              file.type.startsWith('text/') ||
              file.type === 'application/json' ||
              file.type === 'application/javascript' ||
              file.type === 'application/xml' ||
              file.type === '' || // Some systems don't set MIME type
              file.name.match(
                /\.(txt|js|ts|jsx|tsx|py|java|cpp|c|h|css|html|xml|json|md|yml|yaml|ini|conf|cfg|log|sql|sh|bat|ps1|php|rb|go|rs|swift|kt|scala|r|m|mm|cs|vb|dart|lua|pl|awk|sed)$/i
              )
            ) {
              console.log('Processing text-based file:', file.name);
              e.preventDefault();
              fileProcessed = true;

              // Use FileReader to read the file content
              const reader = new FileReader();

              reader.onload = function (readerEvent) {
                console.log(
                  'File read successfully, length:',
                  readerEvent.target.result.length
                );
                const fileContent = readerEvent.target.result;
                const currentContent = codeArea.value;
                const separator = currentContent
                  ? '\n\n// === ' + file.name + ' ===\n'
                  : '// === ' + file.name + ' ===\n';
                const newContent = currentContent
                  ? currentContent + separator + fileContent
                  : fileContent;
                codeArea.value = newContent;

                handleTextChange();
                showNotification(
                  `📄 File "${file.name}" (${file.size} bytes) pasted successfully!`,
                  'success'
                );

                // Scroll to bottom
                codeArea.scrollTop = codeArea.scrollHeight;
              };

              reader.onerror = function (err) {
                console.error('FileReader error:', err);
                showNotification(
                  `❌ Error reading file "${file.name}": ${
                    err.message || 'Unknown error'
                  }`,
                  'error'
                );
              };

              reader.onabort = function () {
                console.log('FileReader aborted');
                showNotification(
                  `⚠️ Reading file "${file.name}" was aborted`,
                  'error'
                );
              };

              // Start reading the file as text
              console.log('Starting to read file as text...');
              reader.readAsText(file);
              break;
            } else {
              console.log('File type not supported:', file.type, file.name);
              showNotification(
                `❌ File type not supported: "${file.name}" (${
                  file.type || 'unknown type'
                })`,
                'error'
              );
            }
          }
        }

        if (!fileProcessed) {
          console.log('No files found, processing as regular text paste');
          // Let normal text paste complete, then update
          setTimeout(handleTextChange, 10);
        }
      }

      function resetCounter() {
        totalLines = 0;
        pasteCount = 0;
        currentText = '';
        codeArea.value = '';
        updateDisplay();

        // Add a small animation effect
        progressRatio.style.transform = 'scale(1.1)';
        setTimeout(() => {
          progressRatio.style.transform = 'scale(1)';
        }, 200);
      }

      // Global paste handler for Ctrl+V when not focused on textarea
      document.addEventListener('keydown', async function (e) {
        // Check if Ctrl+V (or Cmd+V on Mac) is pressed and textarea is not focused
        if (
          (e.ctrlKey || e.metaKey) &&
          e.key === 'v' &&
          document.activeElement !== codeArea
        ) {
          e.preventDefault();

          try {
            // Read text from clipboard
            const clipboardText = await navigator.clipboard.readText();
            if (clipboardText) {
              // Append to existing content
              const currentContent = codeArea.value;
              const newContent = currentContent
                ? currentContent + '\n' + clipboardText
                : clipboardText;
              codeArea.value = newContent;

              // Update counters
              pasteCount++;
              handleTextChange();

              // Visual feedback
              codeArea.style.border = '2px solid #56ccf2';
              setTimeout(() => {
                codeArea.style.border = '2px solid #e0e6ed';
              }, 500);

              // Scroll textarea to bottom to show new content
              codeArea.scrollTop = codeArea.scrollHeight;
            }
          } catch (err) {
            // Fallback for browsers that don't support clipboard API
            console.log('Clipboard access not available:', err);

            // Show a helpful message
            const notification = document.createElement('div');
            notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #ff6b6b;
                        color: white;
                        padding: 15px 20px;
                        border-radius: 10px;
                        z-index: 1000;
                        font-size: 0.9em;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    `;
            notification.textContent =
              'Please focus on the textarea and paste there, or allow clipboard permissions.';
            document.body.appendChild(notification);

            setTimeout(() => {
              document.body.removeChild(notification);
            }, 3000);
          }
        }
      });

      // Event listeners
      codeArea.addEventListener('paste', handlePaste);
      codeArea.addEventListener('input', handleTextChange);
      coefficientInput.addEventListener('input', updateDisplay);
      targetInput.addEventListener('input', updateDisplay);

      // Initialize display
      updateDisplay();

      // Add some visual feedback for focus
      codeArea.addEventListener('focus', function () {
        this.parentElement.style.transform = 'translateY(-2px)';
      });

      codeArea.addEventListener('blur', function () {
        this.parentElement.style.transform = 'translateY(0)';
      });
    </script>
  </body>
</html>
